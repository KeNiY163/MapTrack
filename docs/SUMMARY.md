# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç - –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚úÖ

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ (src, tests, scripts, data, config, docker, docs, trash)
- –í—Å–µ —Ñ–∞–π–ª—ã —Ä–∞—Å–∫–∏–¥–∞–Ω—ã –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø–∞–ø–∫–∞–º
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–∞ –≤ docs/

### 2. ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–¢–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ –∏–∑ env** - —É–±—Ä–∞–Ω –∏–∑ –∫–æ–¥–∞
- **–§–∏–∫—Å –∏—Å—Ç–æ—Ä–∏–∏** - —É–±—Ä–∞–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
- **–£–¥–∞–ª–µ–Ω message_cache** - —É–±—Ä–∞–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è JSON** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
- **–í—ã–Ω–µ—Å–µ–Ω Selenium** - —Å–æ–∑–¥–∞–Ω ContainerTrackerService

### 3. ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ python-telegram-bot
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Application` –≤–º–µ—Å—Ç–æ long polling
- **JobQueue –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ContainerTrackerService

### 4. ‚úÖ –ö–µ—à Nominatim
- –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/geocache.py`
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ 30 –¥–Ω–µ–π
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–µ—à–∞ (hits, misses, size)

### 5. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–µ—à–∞ (hits, misses, size, duration)
- –ú–µ—Ç—Ä–∏–∫–∏ –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- –ú–µ—Ç—Ä–∏–∫–∏ Selenium (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π)

### 6. ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ Docker
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Dockerfile (python:3.11-slim)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º (src/, data/)
- Healthcheck –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –°–æ–∑–¥–∞–Ω .dockerignore

### 7. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏ –æ—Ç–¥–∞–Ω—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É
- Docker `restart: unless-stopped`
- Healthcheck –≤ Dockerfile –∏ docker-compose
- –£–±—Ä–∞–Ω bot_runner –∏–∑ Docker (–æ—Å—Ç–∞–ª—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

## üìÅ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
MapTrack/
‚îú‚îÄ‚îÄ src/                    # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ bot.py              # –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (python-telegram-bot)
‚îÇ   ‚îú‚îÄ‚îÄ bot_runner.py       # –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ container_tracker.py # –°–µ—Ä–≤–∏—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è (Selenium)
‚îÇ   ‚îú‚îÄ‚îÄ geocache.py         # –ö–µ—à Nominatim
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py         # –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ view_metrics.py     # –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
‚îÇ
‚îú‚îÄ‚îÄ data/                   # –î–∞–Ω–Ω—ã–µ (JSON —Ñ–∞–π–ª—ã)
‚îÇ   ‚îú‚îÄ‚îÄ history.json
‚îÇ   ‚îú‚îÄ‚îÄ schedule.json
‚îÇ   ‚îú‚îÄ‚îÄ cities.json
‚îÇ   ‚îî‚îÄ‚îÄ geocache.json       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è
‚îÇ
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml  # –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è (—Å Prometheus/Grafana)
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.simple.yml  # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ prometheus.yml
‚îÇ
‚îú‚îÄ‚îÄ docker/                 # Docker —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile          # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
‚îÇ
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ (–≤—Å–µ .md –∏ .txt —Ñ–∞–π–ª—ã)
‚îÇ
‚îú‚îÄ‚îÄ tests/                  # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ scripts/                # –°–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ trash/                  # –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ requirements.txt
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
export BOT_TOKEN="your_token"
python src/bot.py
```

### –° –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º (–ª–æ–∫–∞–ª—å–Ω–æ):
```bash
python src/bot_runner.py
```

### Docker (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º):
```bash
cd config
docker-compose up -d
```

### Docker (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è):
```bash
cd config
docker-compose -f docker-compose.simple.yml up -d
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏

–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ `http://localhost:8000/metrics`:

**–û—Å–Ω–æ–≤–Ω—ã–µ:**
- `bot_messages_total` - —Å–æ–æ–±—â–µ–Ω–∏—è
- `bot_commands_total` - –∫–æ–º–∞–Ω–¥—ã
- `bot_errors_total` - –æ—à–∏–±–∫–∏
- `bot_track_requests_total` - –∑–∞–ø—Ä–æ—Å—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `bot_track_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `bot_active_users` - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `bot_scheduled_checks_total` - –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ:**
- `bot_geocache_hits_total` - –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫–µ—à
- `bot_geocache_misses_total` - –ø—Ä–æ–º–∞—Ö–∏ –∫–µ—à–∞
- `bot_geocache_size` - —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞
- `bot_geocoding_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
- `bot_selenium_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Selenium

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–æ–¥ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - python-telegram-bot + Docker restart policies
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏, healthcheck
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤ –∫ —Ä–æ—Å—Ç—É –Ω–∞–≥—Ä—É–∑–∫–∏
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π Docker, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üéâ –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é.



